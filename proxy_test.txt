# VIYA REST
filename tok "%sysfunc(getoption(WORK))/services_token.txt";
data _null_;
  file tok lrecl=32767;
  put "%sysget(SAS_SERVICES_TOKEN)";
run;



%put NOTE: SAS_SERVICES_TOKEN=%sysget(SAS_SERVICES_TOKEN);
%put NOTE: SAS_ACCESS_TOKEN=%sysget(SAS_ACCESS_TOKEN);

#CLI
curl -s -H "Authorization: Bearer EY_TU_TOKEN" \
  "https://tu-viya/microanalyticScore/modules?limit=1"


curl -s -X POST \
  -u "viya_client:" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=password&username=MI_USUARIO&password=MI_PASSWORD&scope=openid" \
  "https://TU-VIYA/SASLogon/oauth/token"


# Reemplazá <ns> por tu namespace y <PAT> por el token (sin < >)
kubectl exec -n <ns> -it sas-model-publish-6f8dbdd879-zthcq -- sh -lc '
  echo "== Probar reachability ==";
  curl -sI https://github.com | head -n 3 || true;

  echo "== Probar Git endpoint con auth básica (debería dar 200) ==";
  PAT="<PAT>"; USER="fauserics";
  curl -s -o /dev/null -w "HTTP %{http_code}\n" \
    -u "$USER:$PAT" \
    "https://github.com/fauserics/sas.git/info/refs?service=git-upload-pack";


kubectl run curlbox -n <tu-namespace> -it --rm --restart=Never \
  --image=curlimages/curl -- sh

# ¿Resuelve DNS?
nslookup github.com || getent hosts github.com

# ¿Responde el sitio?
curl -I --connect-timeout 5 --max-time 10 https://github.com

# ¿Abre el puerto 443?
curl -sS --connect-timeout 5 --max-time 10 https://github.com > /dev/null && echo OK || echo FAIL

# Prueba del endpoint que usa git (con auth básica)
USER=fauserics
PAT='tu_token_aqui'
curl -sS -u "$USER:$PAT" --connect-timeout 5 --max-time 15 \
  "https://github.com/fauserics/sas.git/info/refs?service=git-upload-pack" | head


kubectl run curlbox -n <ns> --rm -it --restart=Never --image=curlimages/curl -- sh
# ya dentro del pod:
USER=fauserics
PAT='ghp_xxx'

# GitHub API requiere User-Agent: ponelo
curl -I -H 'User-Agent: curl' --connect-timeout 5 --max-time 10 https://api.github.com

# Ahora con auth: debería devolver JSON con "login": "fauserics"
curl -sS -u "$USER:$PAT" -H 'User-Agent: curl' \
     --connect-timeout 5 --max-time 15 \
     https://api.github.com/user | sed -n '1,30p'
exit

kubectl run gitbox -n <ns> --rm -it --restart=Never --image=alpine/git -- sh
USER=fauserics
PAT='ghp_xxx'

# Forzamos verbosidad y límite de velocidad para que NO cuelgue eternamente
GIT_CURL_VERBOSE=1 git -c http.lowSpeedLimit=1 -c http.lowSpeedTime=5 \
  ls-remote https://$USER:$PAT@github.com/fauserics/sas.git | head
exit

# dentro de un pod de prueba (curlbox)
curl -sS -u "fauserics:$PAT" -H 'User-Agent: curl' \
  https://api.github.com/repos/fauserics/sas/contents/ | head

/*prubea final*/
# abre una shell en un pod de prueba con git
kubectl run gitbox -n <tu-ns> --rm -it --restart=Never --image=alpine/git -- sh

USER=fauserics
PAT='PEGA_AQUI_TU_PAT'

# Verboso + timeouts (para que no “cuelgue”)
GIT_CURL_VERBOSE=1 git -c http.lowSpeedLimit=1 -c http.lowSpeedTime=5 \
  ls-remote https://$USER:$PAT@github.com/fauserics/sas.git | head
exit


'


'
